<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Advanced Recipe Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="style.css">
    
</head>
<body>
  
    <nav>
        <div class="nav-wrapper">
          <a href="#" class="brand-logo">Logo</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="#">Home</a></li>
            <li><a href="#">World Recipes</a></li>
            <li><a href="#">Advanced</a></li>
            <li><a href="#">Saved</a></li>
          </ul>
        </div>
    </nav>

    <p id="advancedPageTitle">Advanced Search</p>

    <div class="advancedFilters">
      <div class="row">
        <form>
          <div class="col s12">
            <div class="input-field">
              <input id="icon_prefix" type="text" class="validate food">
              <label for="icon_prefix">Food</label>
            </div>
          </div>
        </form>
      </div>

      <div>
        <form>
          <div class="row">
            <div class="input-field col s6">
              <input id="icon_prefix" type="text" class="validate minCalories">
              <label for="icon_prefix">Calories MIN</label>
            </div>
            <div class="input-field col s6">
              <input id="icon_prefix" type="text" class="validate maxCalories">
              <label for="icon_prefix">Calories MAX</label>
            </div>
          </div>
        </form>
      </div>

      <div>
        <form>
          <div class="row">
            <div class="input-field col s6">
              <input id="icon_prefix" type="text" class="validate excluded">
              <label for="icon_prefix">Exclude Ingredients</label>
            </div>
            <div class="input-field col s6">
              <input id="icon_prefix" type="text" class="validate numberOfIngredients">
              <label for="icon_prefix"> Max # of recipes</label>
            </div>
          </div>
        </form>
      </div>

    

    <div class="row excludedIngredients">
      <div class="col s2 input-field addTo">
        <a class="waves-effect waves-light btn addToButton">Add to excluded list</a>
      </div>
      <div class="col s2 input-field addTo">
        <a class="waves-effect waves-light btn resetButton">Reset List</a>
      </div>
      <div class="col s6 offset-s6">
        <p id="excludedListTitle">Excluded List:</p>
        <ul class=" excludedListing" id="uList">
        </ul>
      </div>
      
    </div>

      <div class="row healthLabels">
        <p>Health Labels:</p>
        <label>
          <input type="checkbox" class="filled-in" id="vegan"/>
          <span>vegan</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="vegetarian"/>
          <span>vegetarian</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="peanut-free"/>
          <span>peanut-free</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="tree-nut-free"/>
          <span>tree-nut-free</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="alcohol-free"/>
          <span>alcohol-free</span>
        </label>
      </div>

      <div class="row diet">
        <p>Diet:</p>
        <label>
          <input type="checkbox" class="filled-in" id="balanced"/>
          <span>balanced</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="high-fiber"/>
          <span>high-fiber</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="high-protein"/>
          <span>high-protein</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="low-carb"/>
          <span>low-carb</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="low-fat"/>
          <span>low-fat</span>
        </label>
        <label>
          <input type="checkbox" class="filled-in" id="low-sodium"/>
          <span>low-sodium</span>
        </label>
      </div>
      
    </div>

    <div class="row">
      <div class="col s1"></div>
      <div class="col s2 input-field addTo">
        <a class="waves-effect waves-light btn searchButton">Search</a>
      </div>
    </div>
    
      
      <div class="results">
        <div class="note">Click to uncollapse</div>
        <ul class="collapsible collapsibleStyle" id="recipe-container">
          
        </ul>
      </div>
      
      
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
      <script>
        
        //Send a query URL to the Recipe Search API
        $(document).ready(function(){
        $('.collapsible').collapsible();
        });

        var excluded = []
        var ul = $(".excludedListing")
        var li = document.createElement("li");
        var p = document.createElement("p")
        $(".searchButton").on("click", search)
        $(".addToButton").on("click", excludedFunction)
        $(".resetButton").on("click", resetList)

        //Add to excluded list
        function excludedFunction() {
          var p = document.createElement("p")
          var excludedValue = $(".excluded").val()
          if (excludedValue == "") {

          }
          else {
            if (excluded.indexOf(excludedValue) == -1) {
              excluded.push(excludedValue)
            }
          }

          ul.empty()
          p.append(document.createTextNode(excluded))
          ul.append(p)
        }

        //Reset excluded list
        function resetList() {
          var list = document.getElementById("uList")
          ul.empty()
          excluded = []
          
        }


        function search() {
          var food = $(".food").val()
          var minCalories = $(".minCalories").val()
          var maxCalories = $(".maxCalories").val()
          var numberOfRecipes = $(".numberOfIngredients").val()
          var emptyHealthLabels = []
          var emptyDiet = []
          var foodImage = ""
          var foodTitle = ""
          var applicationID = "564187b6"

          var healthLabelsArray = ["vegan","vegetarian","peanut-free",
          "tree-nut-free","alcohol-free"]

          var dietArray = ["balanced","high-fiber","high-protein",
          "low-carb","low-fat","low-sodium"]
  
          //Defaults to 1 number of recipes
          var num = 1
          if (numberOfRecipes != "") {
            num = numberOfRecipes
          }
          
          //Query to recipe search API, num is initilized for number of results
          var appKey = "e86e8beddfc5b70d5c1adfa48105e411"
          var queryURL = "https://api.edamam.com/search?q=" + food + "&app_id=" + applicationID + "&app_key=" 
          + appKey + "&to=" + num


          //Health lables
          for (var i = 0; i < healthLabelsArray.length; i++) {
            var healthLabel = "#" + [healthLabelsArray[i]]
            if ($(healthLabel).prop("checked") === true) {
              var label1 = healthLabelsArray[i]
              queryURL = queryURL + "&health=" + healthLabelsArray[i]

            }
  
          }
          
          //Diet Labels
          for (var i = 0; i < dietArray.length; i++) {
            var dietLabel = "#" + [dietArray[i]]
            if ($(dietLabel).prop("checked") === true) {
              var label2 = dietArray[i]
              queryURL = queryURL + "&diet=" + dietArray[i] 
            }
          }

        //Calories
        if (minCalories == "" && maxCalories == "") {
        }
        else if ((minCalories != "") && (maxCalories != "")) {
          var cal = "&calories=" + minCalories + "-" + maxCalories
          queryURL = queryURL + cal
        }
        else {
          if (minCalories !=   "") {
            var cal = "&calories=" + minCalories
            queryURL = queryURL + cal
          }
          else {
            var cal = "&calories=" + maxCalories
            queryURL = queryURL + cal
          }
        }

        //Excluded
        if (excluded.length > 0) {
          for (var i = 0; i < excluded.length; i++) {
            queryURL = queryURL + "&excluded=" + excluded[i]
          }
        }
        

        console.log(queryURL)

          $.ajax({
        url: queryURL,
        method: "GET"
        }).then(function(response) {

            //Clears old search
            $(".collapsibleStyle").empty()

            //Limits the number of results for the collapse for loop
            var numberofRecipes = 1

            for (var i = 0; i < numberofRecipes; i++) {
              //Save recipe title, image, and ingredients array to variables
              var foodTitle = response.hits[i].recipe.label
              var foodImage = response.hits[i].recipe.image
              var ingredients = response.hits[i].recipe.ingredientLines
              var prep = response.hits[i].recipe.url

              //select container element
              //var container = $("#recipe-container");
              var container = $("#recipe-container")
              //create and append new list item
              var newRecipe = $("<li>");
              container.append(newRecipe);
              newRecipe.addClass("active")

              //create and append header div
              var header = $("<div>");
              newRecipe.append(header);
              header.addClass("collapsible-header");
              header.text(foodTitle)

              //create and append body div
              var body = $("<div>");
              newRecipe.append(body);
              body.addClass("collapsible-body");
              body.attr("style", "display: block;")

              //Create and append organizing grid containers
              var row = $("<div>");
              var left = $("<div>");
              var middle = $("<div>");
              var right = $("<div>");
              row.addClass("row");
              left.addClass("col s4");
              right.addClass("col s8");
              body.append(row);
              row.append(left);
              row.append(right);

              //Create and append image using recipe image
              var image = $("<img>");
              image.attr("src", foodImage);
              left.append(image);

              //Create and append "Ingredients" title
              var ingredientTitle = $("<h5>");
              ingredientTitle.text("Ingredients:");
              right.append(ingredientTitle);

              //Create and append a list container inside body
              var ingredientList = $("<ul>");
              right.append(ingredientList);

              //loop through ingredients array and add list items for each
              for (j = 0; j < ingredients.length; j++) {
                var newItem = $("<li>");
                ingredientList.append(newItem);
                newItem.text(ingredients[j])
              }

              //Create and append link to preperation instructions
              var prepTitle = $("<h5>");
              right.append(prepTitle);

              var prepLink = $("<a>");
              prepLink.text("Preparation");
              prepLink.attr("href", prep);
              prepLink.addClass("waves-effect waves-light btn");
              prepTitle.append(prepLink);

            }

        });
          
        }

        //nav bars
        //index
        //saved page
        
      </script>
      
</body>
</html>